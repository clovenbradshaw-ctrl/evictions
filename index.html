<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eviction Detainer Dashboard - Nashville Sessions Court</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        // Icon SVG components as strings
        const icons = {
            search: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>',
            download: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>',
            building: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"></path></svg>',
            scale: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"></path><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"></path><path d="M7 21h10"></path><path d="M12 3v18"></path></svg>',
            user: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
            alert: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>'
        };

        // State management
        let state = {
            data: [],
            loading: true,
            error: null,
            searchTerm: '',
            selectedView: 'overview',
            filterCriteria: {
                attorney: 'all',
                plaintiff: 'all',
                status: 'all'
            }
        };

        let charts = {};

        // Fetch data
        async function fetchData() {
            try {
                const response = await fetch('https://xvkq-pq7i-idtl.n7d.xano.io/api:gx-QnxD1/detainers');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();
                state.data = result;
                state.loading = false;
                render();
            } catch (error) {
                console.error('Error fetching data:', error);
                state.error = error.message;
                state.loading = false;
                render();
            }
        }

        // Process data
        function getProcessedData() {
            let filtered = state.data;

            if (state.filterCriteria.attorney !== 'all') {
                filtered = filtered.filter(d => d.Attorney === state.filterCriteria.attorney);
            }
            if (state.filterCriteria.plaintiff !== 'all') {
                filtered = filtered.filter(d => d.Plaintiff_Petitioner === state.filterCriteria.plaintiff);
            }
            if (state.filterCriteria.status !== 'all') {
                filtered = filtered.filter(d => d.Status === state.filterCriteria.status);
            }

            if (state.searchTerm) {
                filtered = filtered.filter(d => 
                    d.Defendant_Respondent?.toLowerCase().includes(state.searchTerm.toLowerCase()) ||
                    d.Plaintiff_Petitioner?.toLowerCase().includes(state.searchTerm.toLowerCase()) ||
                    d.Docket_Number?.toLowerCase().includes(state.searchTerm.toLowerCase()) ||
                    d.Attorney?.toLowerCase().includes(state.searchTerm.toLowerCase())
                );
            }

            return filtered;
        }

        // Calculate analytics
        function getAnalytics() {
            const processedData = getProcessedData();
            const attorneyCount = {};
            const plaintiffCount = {};
            const dailyFilings = {};
            
            processedData.forEach(d => {
                const attorney = d.Attorney || 'Pro Se';
                attorneyCount[attorney] = (attorneyCount[attorney] || 0) + 1;
                
                const plaintiff = d.Plaintiff_Petitioner;
                plaintiffCount[plaintiff] = (plaintiffCount[plaintiff] || 0) + 1;
                
                const date = d.File_Date;
                dailyFilings[date] = (dailyFilings[date] || 0) + 1;
            });

            const attorneyData = Object.entries(attorneyCount)
                .map(([name, count]) => ({ name, count }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 10);

            const plaintiffData = Object.entries(plaintiffCount)
                .map(([name, count]) => ({ name: name.length > 30 ? name.substring(0, 30) + '...' : name, fullName: name, count }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 15);

            const corporateLandlords = processedData.filter(d => 
                d.Plaintiff_Petitioner?.includes('LLC') || 
                d.Plaintiff_Petitioner?.includes('LP') ||
                d.Plaintiff_Petitioner?.includes('CORP') ||
                d.Plaintiff_Petitioner?.includes('INC')
            ).length;

            const proSeCount = processedData.filter(d => 
                d.Attorney?.includes('PRS') || d.Attorney?.trim() === ','
            ).length;

            return {
                attorneyData,
                plaintiffData,
                dailyFilings,
                totalCases: processedData.length,
                corporateLandlords,
                individualLandlords: processedData.length - corporateLandlords,
                representedByAttorney: processedData.length - proSeCount,
                proSe: proSeCount
            };
        }

        // Create charts
        function createPieChart(canvasId, data, labels) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ['#ef4444', '#f97316', '#f59e0b', '#84cc16', '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createBarChart(canvasId, data, labels, label = 'Count') {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: '#3b82f6'
                    }]
                },
                options: {
                    indexAxis: labels.length > 10 ? 'y' : 'x',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createLineChart(canvasId, data, labels) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Filings per Day',
                        data: data,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Export to CSV
        function exportToCSV() {
            const processedData = getProcessedData();
            const csv = [
                Object.keys(processedData[0] || {}).join(','),
                ...processedData.map(row => Object.values(row).join(','))
            ].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `eviction-data-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Render functions
        function render() {
            const app = document.getElementById('app');
            
            if (state.loading) {
                app.innerHTML = `
                    <div class="flex items-center justify-center h-screen">
                        <div class="text-center">
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                            <p class="text-gray-600">Loading eviction data...</p>
                        </div>
                    </div>
                `;
                return;
            }

            if (state.error) {
                app.innerHTML = `
                    <div class="flex items-center justify-center h-screen">
                        <div class="text-center max-w-md p-6 bg-white rounded-lg shadow-lg">
                            <div class="text-red-500 mb-4">${icons.alert}</div>
                            <h2 class="text-xl font-bold text-gray-900 mb-2">Unable to Load Data</h2>
                            <p class="text-gray-600 mb-4">${state.error}</p>
                            <button onclick="fetchData()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                Retry
                            </button>
                        </div>
                    </div>
                `;
                return;
            }

            const analytics = getAnalytics();
            const uniqueAttorneys = [...new Set(state.data.map(d => d.Attorney))].sort();
            const uniquePlaintiffs = [...new Set(state.data.map(d => d.Plaintiff_Petitioner))].sort();

            app.innerHTML = `
                <div class="min-h-screen p-6">
                    <div class="max-w-7xl mx-auto">
                        <!-- Header -->
                        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
                                        ${icons.scale}
                                        Eviction Detainer Dashboard
                                    </h1>
                                    <p class="text-gray-600 mt-1">Nashville Sessions Court - Defense Analysis Tool</p>
                                </div>
                                <button onclick="exportToCSV()" class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                    ${icons.download}
                                    Export Data
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="relative">
                                    <div class="absolute left-3 top-3 text-gray-400">${icons.search}</div>
                                    <input
                                        type="text"
                                        placeholder="Search defendants, plaintiffs, docket..."
                                        value="${state.searchTerm}"
                                        oninput="updateSearch(this.value)"
                                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                </div>
                                
                                <select onchange="updateFilter('attorney', this.value)" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="all">All Attorneys</option>
                                    ${uniqueAttorneys.map(a => `<option value="${a}" ${state.filterCriteria.attorney === a ? 'selected' : ''}>${a || 'Pro Se'}</option>`).join('')}
                                </select>

                                <select onchange="updateFilter('plaintiff', this.value)" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="all">All Landlords</option>
                                    ${uniquePlaintiffs.slice(0, 50).map(p => `<option value="${p}" ${state.filterCriteria.plaintiff === p ? 'selected' : ''}>${p.length > 40 ? p.substring(0, 40) + '...' : p}</option>`).join('')}
                                </select>

                                <select onchange="updateFilter('status', this.value)" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="all">All Statuses</option>
                                    <option value="PENDING" ${state.filterCriteria.status === 'PENDING' ? 'selected' : ''}>Pending</option>
                                    <option value="CLOSED" ${state.filterCriteria.status === 'CLOSED' ? 'selected' : ''}>Closed</option>
                                </select>
                            </div>
                        </div>

                        <!-- Key Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <div class="bg-white rounded-lg shadow-sm p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600 text-sm">Total Cases</p>
                                        <p class="text-3xl font-bold text-gray-900">${analytics.totalCases}</p>
                                    </div>
                                    <div class="text-red-500">${icons.alert}</div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow-sm p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600 text-sm">Corporate Landlords</p>
                                        <p class="text-3xl font-bold text-gray-900">${analytics.corporateLandlords}</p>
                                        <p class="text-xs text-gray-500 mt-1">${((analytics.corporateLandlords / analytics.totalCases) * 100).toFixed(1)}% of cases</p>
                                    </div>
                                    <div class="text-blue-500">${icons.building}</div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow-sm p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600 text-sm">Attorney Represented</p>
                                        <p class="text-3xl font-bold text-gray-900">${analytics.representedByAttorney}</p>
                                        <p class="text-xs text-gray-500 mt-1">${((analytics.representedByAttorney / analytics.totalCases) * 100).toFixed(1)}% of cases</p>
                                    </div>
                                    <div class="text-purple-500">${icons.scale}</div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow-sm p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600 text-sm">Pro Se Filers</p>
                                        <p class="text-3xl font-bold text-gray-900">${analytics.proSe}</p>
                                        <p class="text-xs text-gray-500 mt-1">${((analytics.proSe / analytics.totalCases) * 100).toFixed(1)}% of cases</p>
                                    </div>
                                    <div class="text-green-500">${icons.user}</div>
                                </div>
                            </div>
                        </div>

                        <!-- View Selector -->
                        <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                            <div class="flex gap-2 overflow-x-auto">
                                ${['overview', 'attorneys', 'landlords', 'timeline', 'cases'].map(view => `
                                    <button
                                        onclick="changeView('${view}')"
                                        class="px-4 py-2 rounded-lg transition whitespace-nowrap ${
                                            state.selectedView === view
                                                ? 'bg-blue-600 text-white'
                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                        }"
                                    >
                                        ${view.charAt(0).toUpperCase() + view.slice(1)}
                                    </button>
                                `).join('')}
                            </div>
                        </div>

                        <!-- View Content -->
                        <div id="viewContent"></div>

                        <!-- Footer -->
                        <div class="mt-6 bg-white rounded-lg shadow-sm p-4 text-center text-sm text-gray-600">
                            <p>Data from Nashville Sessions Court | Last Updated: ${new Date().toLocaleString()}</p>
                        
                        </div>
                    </div>
                </div>
            `;

            renderView();
        }

        function renderView() {
            const viewContent = document.getElementById('viewContent');
            if (!viewContent) return;

            const analytics = getAnalytics();
            const processedData = getProcessedData();

            if (state.selectedView === 'overview') {
                viewContent.innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">Corporate vs Individual Landlords</h3>
                            <div class="chart-container">
                                <canvas id="corporateChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">Representation Status</h3>
                            <div class="chart-container">
                                <canvas id="representationChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm p-6 lg:col-span-2">
                            <h3 class="text-lg font-semibold mb-4">Top 10 Filing Attorneys</h3>
                            <div class="chart-container">
                                <canvas id="attorneyChart"></canvas>
                            </div>
                            <p class="text-sm text-gray-600 mt-4">
                                <strong>Defense Strategy Note:</strong> Serial filers may use standardized forms and processes. 
                                Look for patterns in procedural compliance and documentation quality.
                            </p>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    createPieChart('corporateChart', 
                        [analytics.corporateLandlords, analytics.individualLandlords],
                        ['Corporate Landlords', 'Individual Landlords']
                    );
                    createPieChart('representationChart',
                        [analytics.representedByAttorney, analytics.proSe],
                        ['Attorney Represented', 'Pro Se']
                    );
                    createBarChart('attorneyChart',
                        analytics.attorneyData.map(a => a.count),
                        analytics.attorneyData.map(a => a.name),
                        'Number of Filings'
                    );
                }, 100);

            } else if (state.selectedView === 'attorneys') {
                viewContent.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Attorney Filing Patterns</h3>
                        <div class="chart-container" style="height: 500px;">
                            <canvas id="attorneyPatternChart"></canvas>
                        </div>
                        <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-900 mb-2">Defense Analysis Tips:</h4>
                            <ul class="text-sm text-blue-800 space-y-1">
                                <li>• High-volume filers may be more prone to procedural errors</li>
                                <li>• Document patterns in notice requirements and service methods</li>
                                <li>• Check for proper landlord-tenant compliance in serial filer cases</li>
                                <li>• Pro se landlords may lack knowledge of tenant rights and protections</li>
                            </ul>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    createBarChart('attorneyPatternChart',
                        analytics.attorneyData.map(a => a.count),
                        analytics.attorneyData.map(a => a.name),
                        'Number of Filings'
                    );
                }, 100);

            } else if (state.selectedView === 'landlords') {
                viewContent.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Top Eviction Filers (Landlords)</h3>
                        <div class="chart-container" style="height: 600px;">
                            <canvas id="landlordChart"></canvas>
                        </div>
                        <div class="mt-6 bg-red-50 border border-red-200 rounded-lg p-4">
                            <h4 class="font-semibold text-red-900 mb-2">Landlord Pattern Analysis:</h4>
                            <ul class="text-sm text-red-800 space-y-1">
                                <li>• Corporate landlords often have more resources for litigation</li>
                                <li>• Serial evictors may indicate systemic housing quality issues</li>
                                <li>• Track repeated filings for pattern of retaliatory evictions</li>
                                <li>• Large property managers may have consistent procedural approaches</li>
                            </ul>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    createBarChart('landlordChart',
                        analytics.plaintiffData.map(p => p.count),
                        analytics.plaintiffData.map(p => p.name),
                        'Number of Cases'
                    );
                }, 100);

            } else if (state.selectedView === 'timeline') {
                const filingDates = Object.keys(analytics.dailyFilings).sort();
                const filingCounts = filingDates.map(date => analytics.dailyFilings[date]);

                viewContent.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Filing Timeline</h3>
                        <div class="chart-container">
                            <canvas id="timelineChart"></canvas>
                        </div>
                        <div class="mt-6 bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-semibold text-green-900 mb-2">Temporal Pattern Notes:</h4>
                            <ul class="text-sm text-green-800 space-y-1">
                                <li>• Spikes may correlate with end-of-month rent due dates</li>
                                <li>• Monitor for patterns following policy changes or moratorium expirations</li>
                                <li>• Seasonal trends may indicate targeting of vulnerable populations</li>
                            </ul>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    createLineChart('timelineChart', filingCounts, filingDates);
                }, 100);

            } else if (state.selectedView === 'cases') {
                viewContent.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Case Details (${processedData.length} cases)</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50 border-b-2 border-gray-200">
                                    <tr>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Docket #</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Filed</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Plaintiff (Landlord)</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Defendant (Tenant)</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Attorney</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${processedData.map(record => `
                                        <tr class="hover:bg-gray-50 transition">
                                            <td class="px-4 py-3 font-mono text-blue-600">${record.Docket_Number}</td>
                                            <td class="px-4 py-3">${record.File_Date}</td>
                                            <td class="px-4 py-3">
                                                <div class="max-w-xs truncate" title="${record.Plaintiff_Petitioner}">
                                                    ${record.Plaintiff_Petitioner}
                                                </div>
                                                ${(record.Plaintiff_Petitioner?.includes('LLC') || 
                                                   record.Plaintiff_Petitioner?.includes('LP') ||
                                                   record.Plaintiff_Petitioner?.includes('CORP')) ? 
                                                    '<span class="inline-block px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded mt-1">Corporate</span>' : ''
                                                }
                                            </td>
                                            <td class="px-4 py-3 font-semibold">${record.Defendant_Respondent}</td>
                                            <td class="px-4 py-3">
                                                ${record.Attorney?.includes('PRS') || record.Attorney?.trim() === ',' ? 
                                                    '<span class="inline-block px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded">Pro Se</span>' : 
                                                    record.Attorney
                                                }
                                            </td>
                                            <td class="px-4 py-3">
                                                <span class="inline-block px-2 py-1 text-xs rounded ${
                                                    record.Status === 'PENDING' ? 
                                                        'bg-red-100 text-red-800' : 
                                                        'bg-gray-100 text-gray-800'
                                                }">
                                                    ${record.Status}
                                                </span>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
        }

        // Event handlers
        function updateSearch(value) {
            state.searchTerm = value;
            render();
        }

        function updateFilter(type, value) {
            state.filterCriteria[type] = value;
            render();
        }

        function changeView(view) {
            state.selectedView = view;
            render();
        }

        // Initialize
        fetchData();
    </script>
</body>
</html>
