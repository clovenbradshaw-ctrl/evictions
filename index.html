<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eviction Detainer Dashboard - Enhanced</title>
    <link rel="icon" type="image/png" href="https://storage.googleapis.com/intelechia-content/im/eviction%20prevention%20logo.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuzzysort@2.0.4/fuzzysort.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
        .tab-dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .tab-drag-over {
            border-left: 3px solid #3b82f6;
        }
        .draggable-tab {
            cursor: grab;
            user-select: none;
        }
        .draggable-tab:active {
            cursor: grabbing;
        }
        .bucket-rule {
            transition: all 0.2s;
        }
        .bucket-rule:hover {
            background-color: #f9fafb;
        }
        .tab-edit-mode .draggable-tab {
            animation: shake 0.3s ease-in-out infinite;
        }
        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-1deg); }
            75% { transform: rotate(1deg); }
        }
        .tab-edit-indicator {
            display: none;
        }
        .tab-edit-mode .tab-edit-indicator {
            display: inline-block;
        }
        
        /* Mobile Responsive Styles */
        .mobile-menu-hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .mobile-hide {
                display: none !important;
            }
            .mobile-menu-button {
                display: flex !important;
            }
            .desktop-button-text {
                display: none;
            }
            .case-card {
                background: white;
                border: 1px solid #e5e7eb;
                border-radius: 0.5rem;
                padding: 1rem;
                margin-bottom: 0.75rem;
            }
            .case-card-header {
                display: flex;
                justify-content: space-between;
                align-items: start;
                margin-bottom: 0.75rem;
                padding-bottom: 0.75rem;
                border-bottom: 1px solid #f3f4f6;
            }
            .case-card-body {
                display: none;
            }
            .case-card.expanded .case-card-body {
                display: block;
            }
            .tabs-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            .tabs-container::-webkit-scrollbar {
                display: none;
            }
            .tabs-wrapper {
                display: inline-flex;
                min-width: 100%;
            }
        }
        
        .filters-collapsed {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .filters-expanded {
            max-height: 500px;
            transition: max-height 0.3s ease-in;
        }
        
        /* Drawer styles for mobile modals */
        @media (max-width: 768px) {
            .mobile-drawer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                max-height: 90vh;
                border-radius: 1rem 1rem 0 0;
                margin: 0;
                animation: slideUp 0.3s ease-out;
            }
            @keyframes slideUp {
                from {
                    transform: translateY(100%);
                }
                to {
                    transform: translateY(0);
                }
            }
        }
        
        /* Touch-friendly tap targets */
        @media (max-width: 768px) {
            button, a, input[type="checkbox"], input[type="radio"] {
                min-height: 44px;
                min-width: 44px;
            }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
            
            /* Hide table, show cards on mobile */
            .desktop-table {
                display: none;
            }
            
            .mobile-cards {
                display: block;
            }
            
            /* Mobile tab scrolling with snap */
            .tab-scroll-container {
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .tab-scroll-container::-webkit-scrollbar {
                display: none;
            }
            
            .tab-scroll-container > div {
                scroll-snap-align: start;
            }
            
            /* Drawer-style modals */
            .mobile-modal {
                align-items: flex-end !important;
            }
            
            .mobile-modal > div {
                max-height: 85vh !important;
                border-radius: 16px 16px 0 0 !important;
                margin: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            /* Larger touch targets */
            button, select, input {
                min-height: 44px;
            }
            
            /* Filter accordion */
            .filter-collapsed {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
            }
            
            .filter-expanded {
                max-height: 500px;
                transition: max-height 0.3s ease;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-cards {
                display: none;
            }
            
            .desktop-table {
                display: table;
            }
            
            .mobile-menu-button {
                display: none;
            }
            
            .mobile-filter-toggle {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        // Icon SVG components
        const icons = {
            search: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>',
            download: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>',
            upload: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>',
            building: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"></path></svg>',
            scale: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"></path><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"></path><path d="M7 21h10"></path><path d="M12 3v18"></path></svg>',
            user: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
            alert: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>',
            calendar: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
            filter: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>',
            folder: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>',
            plus: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',
            x: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',
            edit: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',
            trash: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',
            grip: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="5" r="1"></circle><circle cx="9" cy="12" r="1"></circle><circle cx="9" cy="19" r="1"></circle><circle cx="15" cy="5" r="1"></circle><circle cx="15" cy="12" r="1"></circle><circle cx="15" cy="19" r="1"></circle></svg>',
            menu: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>',
            chevronDown: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>',
            chevronUp: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"></polyline></svg>',
            menu: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>',
            chevronDown: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>',
            chevronUp: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"></polyline></svg>'
        };

        // Default tabs if no custom order exists
        const defaultTabs = [
            { id: 'overview', label: 'Overview', icon: 'building' },
            { id: 'landlords', label: 'Top Landlords', icon: 'building' },
            { id: 'attorneys', label: 'Top Attorneys', icon: 'scale' },
            { id: 'timeline', label: 'Timeline', icon: 'calendar' },
            { id: 'cases', label: 'Case List', icon: 'user' },
            { id: 'buckets', label: 'Buckets', icon: 'folder' }
        ];

        let charts = {};

        // LocalStorage functions
        function loadTabOrder() {
            const saved = localStorage.getItem('eviction_tab_order');
            return saved ? JSON.parse(saved) : defaultTabs;
        }

        function loadBuckets() {
            const saved = localStorage.getItem('eviction_buckets');
            if (saved) {
                return JSON.parse(saved);
            }
            // Default buckets
            return [
                {
                    id: 'corporate',
                    name: 'Corporate Landlords',
                    color: 'blue',
                    rules: [
                        { field: 'Plaintiff_Petitioner', operator: 'contains', value: 'LLC', caseSensitive: false },
                        { field: 'Plaintiff_Petitioner', operator: 'contains', value: 'LP', caseSensitive: false },
                        { field: 'Plaintiff_Petitioner', operator: 'contains', value: 'CORP', caseSensitive: false },
                        { field: 'Plaintiff_Petitioner', operator: 'contains', value: 'INC', caseSensitive: false }
                    ],
                    matchType: 'any' // 'any' or 'all'
                },
                {
                    id: 'pro_se',
                    name: 'Pro Se Defendants',
                    color: 'yellow',
                    rules: [
                        { field: 'Attorney', operator: 'contains', value: 'PRS', caseSensitive: false }
                    ],
                    matchType: 'any'
                }
            ];
        }

        function loadSettings() {
            const saved = localStorage.getItem('eviction_settings');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading settings:', e);
                    return getDefaultSettings();
                }
            }
            return getDefaultSettings();
        }

        function getDefaultSettings() {
            return {
                selectedView: 'overview',
                selectedBucket: 'all',
                searchTerm: '',
                bulkSearchNames: [],
                fuzzyThreshold: 0.7, // 0.0 = exact match only, 1.0 = very loose matching
                filterCriteria: {
                    attorney: 'all',
                    plaintiff: 'all',
                    status: 'all',
                    startDate: getDateDaysAgo(365),
                    endDate: getTodayDate()
                }
            };
        }

        function saveSettings() {
            const settings = {
                selectedView: state.selectedView,
                selectedBucket: state.selectedBucket,
                searchTerm: state.searchTerm,
                bulkSearchNames: state.bulkSearchNames,
                fuzzyThreshold: state.fuzzyThreshold,
                filterCriteria: state.filterCriteria
            };
            localStorage.setItem('eviction_settings', JSON.stringify(settings));
        }

        // State management with localStorage support
        const savedSettings = loadSettings();
        let state = {
            data: [],
            loading: true,
            error: null,
            searchTerm: savedSettings.searchTerm,
            selectedView: savedSettings.selectedView,
            selectedBucket: savedSettings.selectedBucket,
            filterCriteria: savedSettings.filterCriteria,
            fuzzyThreshold: savedSettings.fuzzyThreshold !== undefined ? savedSettings.fuzzyThreshold : 0.7,
            showBucketManager: false,
            showBulkSearch: false,
            showSettingsMenu: false,
            showMobileMenu: false,
            filtersExpanded: false,
            bulkSearchNames: savedSettings.bulkSearchNames,
            tabEditMode: false,
            tabOrder: loadTabOrder(),
            buckets: loadBuckets(),
            pagination: {
                currentPage: 1,
                perPage: 1000,
                totalPages: 1,
                totalItems: 0
            }
        };

        function saveTabOrder(order) {
            localStorage.setItem('eviction_tab_order', JSON.stringify(order));
            state.tabOrder = order;
        }

        function saveBuckets(buckets) {
            localStorage.setItem('eviction_buckets', JSON.stringify(buckets));
            state.buckets = buckets;
        }

        // Helper functions for date handling
        function getTodayDate() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        function getDateDaysAgo(days) {
            const date = new Date();
            date.setDate(date.getDate() - days);
            return date.toISOString().split('T')[0];
        }

        function formatDateForDisplay(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' });
        }

        function formatDateForAPI(dateString) {
            const [year, month, day] = dateString.split('-');
            return `${month}/${day}/${year}`;
        }

        // Bucket matching logic
        function recordMatchesBucket(record, bucket) {
            if (bucket.matchType === 'all') {
                return bucket.rules.every(rule => matchesRule(record, rule));
            } else {
                return bucket.rules.some(rule => matchesRule(record, rule));
            }
        }

        function matchesRule(record, rule) {
            const fieldValue = record[rule.field] || '';
            const searchValue = rule.caseSensitive ? rule.value : rule.value.toLowerCase();
            const recordValue = rule.caseSensitive ? fieldValue : fieldValue.toLowerCase();

            switch (rule.operator) {
                case 'contains':
                    return recordValue.includes(searchValue);
                case 'equals':
                    return recordValue === searchValue;
                case 'starts_with':
                    return recordValue.startsWith(searchValue);
                case 'ends_with':
                    return recordValue.endsWith(searchValue);
                case 'not_contains':
                    return !recordValue.includes(searchValue);
                default:
                    return false;
            }
        }

        // Fetch data
        async function fetchData() {
            try {
                state.loading = true;
                render();

                const params = new URLSearchParams();

                if (state.filterCriteria.startDate) {
                    params.append('start_date', formatDateForAPI(state.filterCriteria.startDate));
                }
                if (state.filterCriteria.endDate) {
                    params.append('end_date', formatDateForAPI(state.filterCriteria.endDate));
                }
                if (state.filterCriteria.status && state.filterCriteria.status !== 'all') {
                    params.append('Status', state.filterCriteria.status);
                }
                if (state.filterCriteria.attorney && state.filterCriteria.attorney !== 'all') {
                    params.append('Attorney', state.filterCriteria.attorney);
                }
                if (state.filterCriteria.plaintiff && state.filterCriteria.plaintiff !== 'all') {
                    params.append('Plaintiff_Petitioner', state.filterCriteria.plaintiff);
                }

                const queryString = params.toString();
                const url = `https://xvkq-pq7i-idtl.n7d.xano.io/api:gx-QnxD1/detainers?${queryString}`;
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                state.data = result;
                state.pagination.totalItems = result.length;
                
                state.loading = false;
                render();
            } catch (error) {
                console.error('Error fetching data:', error);
                state.error = error.message;
                state.loading = false;
                render();
            }
        }

        // Data processing
        function processData() {
            let filtered = state.data;

            // Apply search filter
            if (state.searchTerm) {
                const searchLower = state.searchTerm.toLowerCase();
                filtered = filtered.filter(record =>
                    (record.Defendant_Respondent?.toLowerCase().includes(searchLower)) ||
                    (record.Plaintiff_Petitioner?.toLowerCase().includes(searchLower)) ||
                    (record.Docket_Number?.toLowerCase().includes(searchLower)) ||
                    (record.Attorney?.toLowerCase().includes(searchLower))
                );
            }

            // Apply bulk search filter with fuzzy matching
            if (state.bulkSearchNames.length > 0 && typeof fuzzysort !== 'undefined') {
                filtered = filtered.filter(record => {
                    const defendant = record.Defendant_Respondent || '';
                    
                    // Try fuzzy matching for each search name
                    return state.bulkSearchNames.some(searchName => {
                        const result = fuzzysort.single(searchName, defendant);
                        // Score ranges from -Infinity (no match) to ~0 (perfect match)
                        // We convert threshold (0-1) to a score threshold
                        // Higher threshold = more strict matching
                        const scoreThreshold = -1000 * (1 - state.fuzzyThreshold);
                        return result && result.score > scoreThreshold;
                    });
                });
            } else if (state.bulkSearchNames.length > 0) {
                // Fallback to simple matching if fuzzysort not loaded
                filtered = filtered.filter(record => {
                    const defendant = (record.Defendant_Respondent || '').toLowerCase();
                    return state.bulkSearchNames.some(name => 
                        defendant.includes(name.toLowerCase())
                    );
                });
            }

            // Apply bucket filter
            if (state.selectedBucket !== 'all') {
                const bucket = state.buckets.find(b => b.id === state.selectedBucket);
                if (bucket) {
                    filtered = filtered.filter(record => recordMatchesBucket(record, bucket));
                }
            }

            return filtered;
        }

        function calculateAnalytics(data) {
            const analytics = {
                totalCases: data.length,
                pendingCases: data.filter(r => r.Status === 'PENDING').length,
                resolvedCases: data.filter(r => r.Status !== 'PENDING').length,
                corporateLandlords: data.filter(r => 
                    r.Plaintiff_Petitioner?.includes('LLC') || 
                    r.Plaintiff_Petitioner?.includes('LP') ||
                    r.Plaintiff_Petitioner?.includes('CORP') ||
                    r.Plaintiff_Petitioner?.includes('INC')
                ).length,
                proSeDefendants: data.filter(r => 
                    r.Attorney?.includes('PRS') || r.Attorney?.trim() === ','
                ).length,
                attorneyData: [],
                plaintiffData: [],
                dailyFilings: {},
                bucketStats: {}
            };

            // Attorney statistics
            const attorneyMap = {};
            data.forEach(record => {
                const attorney = record.Attorney || 'Unknown';
                if (!attorneyMap[attorney]) {
                    attorneyMap[attorney] = 0;
                }
                attorneyMap[attorney]++;
            });
            analytics.attorneyData = Object.entries(attorneyMap)
                .map(([name, count]) => ({ name, count }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 15);

            // Plaintiff statistics
            const plaintiffMap = {};
            data.forEach(record => {
                const plaintiff = record.Plaintiff_Petitioner || 'Unknown';
                if (!plaintiffMap[plaintiff]) {
                    plaintiffMap[plaintiff] = 0;
                }
                plaintiffMap[plaintiff]++;
            });
            analytics.plaintiffData = Object.entries(plaintiffMap)
                .map(([name, count]) => ({ name, count }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 15);

            // Daily filings
            data.forEach(record => {
                const date = record.File_Date || 'Unknown';
                if (!analytics.dailyFilings[date]) {
                    analytics.dailyFilings[date] = 0;
                }
                analytics.dailyFilings[date]++;
            });

            // Bucket statistics
            state.buckets.forEach(bucket => {
                const matchingRecords = data.filter(record => recordMatchesBucket(record, bucket));
                analytics.bucketStats[bucket.id] = {
                    name: bucket.name,
                    count: matchingRecords.length,
                    percentage: ((matchingRecords.length / data.length) * 100).toFixed(1)
                };
            });

            return analytics;
        }

        // Chart creation functions
        function destroyChart(chartId) {
            if (charts[chartId]) {
                charts[chartId].destroy();
                delete charts[chartId];
            }
        }

        function createBarChart(canvasId, data, labels, label) {
            destroyChart(canvasId);
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            charts[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createLineChart(canvasId, data, labels) {
            destroyChart(canvasId);
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Daily Filings',
                        data: data,
                        borderColor: 'rgba(34, 197, 94, 1)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Export to CSV
        function exportToCSV() {
            const data = processData();
            const headers = ['Docket Number', 'File Date', 'Plaintiff', 'Defendant', 'Attorney', 'Status'];
            const rows = data.map(r => [
                r.Docket_Number,
                r.File_Date,
                r.Plaintiff_Petitioner,
                r.Defendant_Respondent,
                r.Attorney,
                r.Status
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.map(cell => `"${cell || ''}"`).join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `eviction-data-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Tab drag and drop with long-press activation
        let draggedTab = null;
        let longPressTimer = null;
        let longPressTarget = null;

        function startLongPress(e, tabId) {
            if (state.tabEditMode) return; // Already in edit mode
            
            longPressTarget = tabId;
            longPressTimer = setTimeout(() => {
                state.tabEditMode = true;
                render();
                // Haptic feedback for mobile devices
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }, 500); // 500ms long press
        }

        function cancelLongPress() {
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
        }

        function handleTabDragStart(e, tabId) {
            if (!state.tabEditMode) {
                e.preventDefault();
                return;
            }
            draggedTab = tabId;
            e.target.classList.add('tab-dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleTabDragOver(e) {
            if (!state.tabEditMode) return;
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const target = e.target.closest('.draggable-tab');
            if (target) {
                target.classList.add('tab-drag-over');
            }
        }

        function handleTabDragLeave(e) {
            const target = e.target.closest('.draggable-tab');
            if (target) {
                target.classList.remove('tab-drag-over');
            }
        }

        function handleTabDrop(e, targetTabId) {
            if (!state.tabEditMode) return;
            e.preventDefault();
            const target = e.target.closest('.draggable-tab');
            if (target) {
                target.classList.remove('tab-drag-over');
            }

            if (draggedTab && draggedTab !== targetTabId) {
                const newOrder = [...state.tabOrder];
                const draggedIndex = newOrder.findIndex(t => t.id === draggedTab);
                const targetIndex = newOrder.findIndex(t => t.id === targetTabId);

                const [removed] = newOrder.splice(draggedIndex, 1);
                newOrder.splice(targetIndex, 0, removed);

                saveTabOrder(newOrder);
                render();
            }
        }

        function handleTabDragEnd(e) {
            e.target.classList.remove('tab-dragging');
            draggedTab = null;
        }

        function exitTabEditMode() {
            state.tabEditMode = false;
            render();
        }

        // Bulk search functions
        function toggleBulkSearch() {
            state.showBulkSearch = !state.showBulkSearch;
            render();
        }

        function renderBulkSearchModal() {
            const thresholdPercentage = Math.round(state.fuzzyThreshold * 100);
            const thresholdLabel = 
                state.fuzzyThreshold >= 0.9 ? 'Very Strict' :
                state.fuzzyThreshold >= 0.7 ? 'Strict' :
                state.fuzzyThreshold >= 0.5 ? 'Moderate' :
                state.fuzzyThreshold >= 0.3 ? 'Loose' : 'Very Loose';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center md:items-center mobile-modal z-50" onclick="if(event.target === this) toggleBulkSearch()">
                    <div class="bg-white rounded-lg md:rounded-lg shadow-xl max-w-2xl w-full m-0 md:m-4 max-h-[85vh] md:max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b px-4 md:px-6 py-4 flex justify-between items-center">
                            <h2 class="text-lg md:text-xl font-bold">Bulk Name Search</h2>
                            <button onclick="toggleBulkSearch()" class="text-gray-500 hover:text-gray-700 p-2">
                                ${icons.x}
                            </button>
                        </div>
                        
                        <div class="p-4 md:p-6 space-y-4">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 md:p-4">
                                <h3 class="font-semibold text-blue-900 mb-2">ðŸŽ¯ Fuzzy Matching</h3>
                                <p class="text-xs md:text-sm text-blue-800">
                                    Fuzzy matching finds names even with typos, misspellings, or partial matches.
                                </p>
                            </div>

                            <div class="space-y-2">
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Match Strictness</span>
                                    <span class="text-xs md:text-sm px-2 md:px-3 py-1 rounded ${
                                        state.fuzzyThreshold >= 0.7 ? 'bg-green-100 text-green-800' :
                                        state.fuzzyThreshold >= 0.5 ? 'bg-yellow-100 text-yellow-800' :
                                        'bg-orange-100 text-orange-800'
                                    }">
                                        ${thresholdLabel} (${thresholdPercentage}%)
                                    </span>
                                </label>
                                <input type="range" 
                                    min="0" 
                                    max="100" 
                                    value="${thresholdPercentage}"
                                    oninput="updateFuzzyThreshold(this.value / 100)"
                                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>Loose</span>
                                    <span>Strict</span>
                                </div>
                            </div>

                            <div>
                                <label class="text-sm font-medium text-gray-700 mb-2 block">
                                    Names to Search (one per line)
                                </label>
                                <textarea 
                                    id="bulkSearchInput"
                                    placeholder="John Smith&#10;Jane Doe&#10;Robert Johnson"
                                    class="w-full h-48 md:h-64 px-3 md:px-4 py-2 border rounded-lg font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >${state.bulkSearchNames.join('\n')}</textarea>
                            </div>
                            
                            <div class="flex flex-col-reverse sm:flex-row justify-between items-stretch sm:items-center gap-2">
                                <button onclick="clearBulkSearch(); toggleBulkSearch()" 
                                    class="px-4 py-3 sm:py-2 text-red-600 hover:text-red-800 border border-red-300 rounded-lg">
                                    Clear All
                                </button>
                                <div class="flex gap-2">
                                    <button onclick="toggleBulkSearch()" 
                                        class="flex-1 sm:flex-initial px-4 py-3 sm:py-2 border rounded-lg hover:bg-gray-50">
                                        Cancel
                                    </button>
                                    <button onclick="processBulkSearch()" 
                                        class="flex-1 sm:flex-initial px-6 py-3 sm:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        Search
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Bucket management UI
        function renderBucketManager() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-end md:items-center justify-center z-50 p-0 md:p-4" onclick="if(event.target === this) toggleBucketManager()">
                    <div class="bg-white rounded-t-2xl md:rounded-lg shadow-xl w-full md:max-w-4xl max-h-[90vh] overflow-y-auto mobile-drawer">
                        <div class="sticky top-0 bg-white border-b px-4 md:px-6 py-4 flex justify-between items-center z-10">
                            <h2 class="text-lg md:text-2xl font-bold">Manage Buckets</h2>
                            <button onclick="toggleBucketManager()" class="text-gray-500 hover:text-gray-700 p-2">
                                ${icons.x}
                            </button>
                        </div>
                        
                        <div class="p-6 space-y-6">
                            ${state.buckets.map((bucket, index) => `
                                <div class="border rounded-lg p-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <input type="text" 
                                                value="${bucket.name}" 
                                                onchange="updateBucketName(${index}, this.value)"
                                                class="text-lg font-semibold border-b border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none px-2 py-1">
                                            <select onchange="updateBucketColor(${index}, this.value)" 
                                                class="px-3 py-1 rounded border bg-${bucket.color}-100 text-${bucket.color}-800 text-sm">
                                                <option value="blue" ${bucket.color === 'blue' ? 'selected' : ''}>Blue</option>
                                                <option value="red" ${bucket.color === 'red' ? 'selected' : ''}>Red</option>
                                                <option value="green" ${bucket.color === 'green' ? 'selected' : ''}>Green</option>
                                                <option value="yellow" ${bucket.color === 'yellow' ? 'selected' : ''}>Yellow</option>
                                                <option value="purple" ${bucket.color === 'purple' ? 'selected' : ''}>Purple</option>
                                                <option value="pink" ${bucket.color === 'pink' ? 'selected' : ''}>Pink</option>
                                            </select>
                                        </div>
                                        <button onclick="deleteBucket(${index})" 
                                            class="text-red-600 hover:text-red-800 p-2">
                                            ${icons.trash}
                                        </button>
                                    </div>

                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between text-sm">
                                            <span class="font-medium">Match Type:</span>
                                            <select onchange="updateBucketMatchType(${index}, this.value)" 
                                                class="px-3 py-1 rounded border text-sm">
                                                <option value="any" ${bucket.matchType === 'any' ? 'selected' : ''}>Any rule (OR)</option>
                                                <option value="all" ${bucket.matchType === 'all' ? 'selected' : ''}>All rules (AND)</option>
                                            </select>
                                        </div>

                                        <div class="space-y-2">
                                            ${bucket.rules.map((rule, ruleIndex) => `
                                                <div class="bucket-rule flex items-center space-x-2 p-2 border rounded">
                                                    <select onchange="updateBucketRule(${index}, ${ruleIndex}, 'field', this.value)" 
                                                        class="flex-1 px-2 py-1 text-sm border rounded">
                                                        <option value="Plaintiff_Petitioner" ${rule.field === 'Plaintiff_Petitioner' ? 'selected' : ''}>Plaintiff</option>
                                                        <option value="Defendant_Respondent" ${rule.field === 'Defendant_Respondent' ? 'selected' : ''}>Defendant</option>
                                                        <option value="Attorney" ${rule.field === 'Attorney' ? 'selected' : ''}>Attorney</option>
                                                        <option value="Status" ${rule.field === 'Status' ? 'selected' : ''}>Status</option>
                                                        <option value="Docket_Number" ${rule.field === 'Docket_Number' ? 'selected' : ''}>Docket #</option>
                                                    </select>
                                                    
                                                    <select onchange="updateBucketRule(${index}, ${ruleIndex}, 'operator', this.value)" 
                                                        class="px-2 py-1 text-sm border rounded">
                                                        <option value="contains" ${rule.operator === 'contains' ? 'selected' : ''}>contains</option>
                                                        <option value="equals" ${rule.operator === 'equals' ? 'selected' : ''}>equals</option>
                                                        <option value="starts_with" ${rule.operator === 'starts_with' ? 'selected' : ''}>starts with</option>
                                                        <option value="ends_with" ${rule.operator === 'ends_with' ? 'selected' : ''}>ends with</option>
                                                        <option value="not_contains" ${rule.operator === 'not_contains' ? 'selected' : ''}>not contains</option>
                                                    </select>
                                                    
                                                    <input type="text" 
                                                        value="${rule.value}" 
                                                        onchange="updateBucketRule(${index}, ${ruleIndex}, 'value', this.value)"
                                                        placeholder="value"
                                                        class="flex-1 px-2 py-1 text-sm border rounded">
                                                    
                                                    <label class="flex items-center space-x-1 text-xs whitespace-nowrap">
                                                        <input type="checkbox" 
                                                            ${rule.caseSensitive ? 'checked' : ''}
                                                            onchange="updateBucketRule(${index}, ${ruleIndex}, 'caseSensitive', this.checked)"
                                                            class="rounded">
                                                        <span>Case</span>
                                                    </label>
                                                    
                                                    <button onclick="deleteBucketRule(${index}, ${ruleIndex})" 
                                                        class="text-red-600 hover:text-red-800 p-1">
                                                        ${icons.x}
                                                    </button>
                                                </div>
                                            `).join('')}
                                        </div>

                                        <button onclick="addBucketRule(${index})" 
                                            class="text-sm text-blue-600 hover:text-blue-800 flex items-center space-x-1">
                                            ${icons.plus}
                                            <span>Add Rule</span>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}

                            <button onclick="createNewBucket()" 
                                class="w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-500 hover:text-blue-600 flex items-center justify-center space-x-2">
                                ${icons.plus}
                                <span>Create New Bucket</span>
                            </button>
                        </div>

                        <div class="sticky bottom-0 bg-gray-50 border-t px-6 py-4 flex justify-end">
                            <button onclick="toggleBucketManager()" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                Done
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Bucket management functions
        function toggleBucketManager() {
            state.showBucketManager = !state.showBucketManager;
            render();
        }

        function createNewBucket() {
            const newBucket = {
                id: 'bucket_' + Date.now(),
                name: 'New Bucket',
                color: 'gray',
                rules: [
                    { field: 'Plaintiff_Petitioner', operator: 'contains', value: '', caseSensitive: false }
                ],
                matchType: 'any'
            };
            state.buckets.push(newBucket);
            saveBuckets(state.buckets);
            render();
        }

        function deleteBucket(index) {
            if (confirm('Are you sure you want to delete this bucket?')) {
                state.buckets.splice(index, 1);
                saveBuckets(state.buckets);
                if (state.selectedBucket === state.buckets[index]?.id) {
                    state.selectedBucket = 'all';
                }
                render();
            }
        }

        function updateBucketName(index, name) {
            state.buckets[index].name = name;
            saveBuckets(state.buckets);
        }

        function updateBucketColor(index, color) {
            state.buckets[index].color = color;
            saveBuckets(state.buckets);
            render();
        }

        function updateBucketMatchType(index, matchType) {
            state.buckets[index].matchType = matchType;
            saveBuckets(state.buckets);
            render();
        }

        function addBucketRule(bucketIndex) {
            state.buckets[bucketIndex].rules.push({
                field: 'Plaintiff_Petitioner',
                operator: 'contains',
                value: '',
                caseSensitive: false
            });
            saveBuckets(state.buckets);
            render();
        }

        function deleteBucketRule(bucketIndex, ruleIndex) {
            state.buckets[bucketIndex].rules.splice(ruleIndex, 1);
            saveBuckets(state.buckets);
            render();
        }

        function updateBucketRule(bucketIndex, ruleIndex, field, value) {
            state.buckets[bucketIndex].rules[ruleIndex][field] = value;
            saveBuckets(state.buckets);
        }

        // Main render function
        function render() {
            const processedData = processData();
            const analytics = calculateAnalytics(processedData);

            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="min-h-screen">
                    <!-- Header -->
                    <div class="bg-white border-b sticky top-0 z-40">
                        <div class="max-w-7xl mx-auto px-4 py-4">
                            <div class="flex flex-col space-y-4">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h1 class="text-xl md:text-2xl font-bold text-gray-900">Eviction Detainer Dashboard</h1>
                                        <p class="text-xs md:text-sm text-gray-600">Nashville Sessions Court</p>
                                    </div>
                                    
                                    <!-- Desktop Actions -->
                                    <div class="hidden md:flex space-x-2">
                                        <button onclick="toggleBulkSearch()" 
                                            class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center space-x-2">
                                            ${icons.search}
                                            <span>Bulk Search</span>
                                            ${state.bulkSearchNames.length > 0 ? `<span class="ml-1 px-2 py-0.5 bg-white text-indigo-600 rounded-full text-xs font-bold">${state.bulkSearchNames.length}</span>` : ''}
                                        </button>
                                        <button onclick="exportToCSV()" 
                                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2">
                                            ${icons.download}
                                            <span>Export CSV</span>
                                        </button>
                                        <button onclick="toggleBucketManager()" 
                                            class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center space-x-2">
                                            ${icons.folder}
                                            <span>Manage Buckets</span>
                                        </button>
                                        <button onclick="showSettingsMenu()" 
                                            class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center space-x-2">
                                            ${icons.filter}
                                            <span>Settings</span>
                                        </button>
                                    </div>

                                    <!-- Mobile Menu Button -->
                                    <button onclick="toggleMobileMenu()" 
                                        class="md:hidden p-2 text-gray-600 hover:text-gray-900">
                                        ${icons.menu}
                                    </button>
                                </div>

                                <!-- Mobile Menu Dropdown -->
                                ${state.showMobileMenu ? `
                                    <div class="md:hidden space-y-2 pb-2">
                                        <button onclick="toggleBulkSearch(); toggleMobileMenu()" 
                                            class="w-full px-4 py-3 bg-indigo-600 text-white rounded-lg flex items-center justify-center space-x-2">
                                            ${icons.search}
                                            <span>Bulk Search</span>
                                            ${state.bulkSearchNames.length > 0 ? `<span class="ml-2 px-2 py-0.5 bg-white text-indigo-600 rounded-full text-xs font-bold">${state.bulkSearchNames.length}</span>` : ''}
                                        </button>
                                        <button onclick="exportToCSV(); toggleMobileMenu()" 
                                            class="w-full px-4 py-3 bg-green-600 text-white rounded-lg flex items-center justify-center space-x-2">
                                            ${icons.download}
                                            <span>Export CSV</span>
                                        </button>
                                        <button onclick="toggleBucketManager(); toggleMobileMenu()" 
                                            class="w-full px-4 py-3 bg-purple-600 text-white rounded-lg flex items-center justify-center space-x-2">
                                            ${icons.folder}
                                            <span>Manage Buckets</span>
                                        </button>
                                        <button onclick="showSettingsMenu(); toggleMobileMenu()" 
                                            class="w-full px-4 py-3 bg-gray-600 text-white rounded-lg flex items-center justify-center space-x-2">
                                            ${icons.filter}
                                            <span>Settings</span>
                                        </button>
                                    </div>
                                ` : ''}

                                ${state.bulkSearchNames.length > 0 ? `
                                    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2">
                                        <div class="flex flex-wrap items-center gap-2">
                                            <span class="text-sm font-medium text-indigo-900">
                                                ðŸŽ¯ Bulk Search Active: ${state.bulkSearchNames.length} names
                                            </span>
                                            <span class="text-xs px-2 py-0.5 rounded ${
                                                state.fuzzyThreshold >= 0.7 ? 'bg-green-100 text-green-700' :
                                                state.fuzzyThreshold >= 0.5 ? 'bg-yellow-100 text-yellow-700' :
                                                'bg-orange-100 text-orange-700'
                                            }">
                                                ${state.fuzzyThreshold >= 0.9 ? 'Very Strict' :
                                                  state.fuzzyThreshold >= 0.7 ? 'Strict' :
                                                  state.fuzzyThreshold >= 0.5 ? 'Moderate' :
                                                  state.fuzzyThreshold >= 0.3 ? 'Loose' : 'Very Loose'}
                                            </span>
                                            <button onclick="toggleBulkSearch()" 
                                                class="text-xs text-indigo-600 hover:text-indigo-800 underline">
                                                Edit
                                            </button>
                                        </div>
                                        <button onclick="clearBulkSearch()" 
                                            class="text-sm text-indigo-600 hover:text-indigo-800 flex items-center space-x-1">
                                            ${icons.x}
                                            <span>Clear</span>
                                        </button>
                                    </div>
                                ` : ''}

                                <!-- Search and Filters -->
                                <div class="flex flex-col gap-3">
                                    <div class="flex flex-col sm:flex-row gap-3">
                                        <div class="flex-1 relative">
                                            <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                                ${icons.search}
                                            </div>
                                            <input type="text" 
                                                placeholder="Search by defendant, plaintiff, docket, attorney..."
                                                value="${state.searchTerm}"
                                                oninput="updateSearch(this.value)"
                                                class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        
                                        <select onchange="updateBucketFilter(this.value)" 
                                            value="${state.selectedBucket}"
                                            class="px-4 py-2 border rounded-lg bg-white">
                                            <option value="all">All Cases</option>
                                            ${state.buckets.map(bucket => `
                                                <option value="${bucket.id}" ${state.selectedBucket === bucket.id ? 'selected' : ''}>
                                                    ${bucket.name} (${analytics.bucketStats[bucket.id]?.count || 0})
                                                </option>
                                            `).join('')}
                                        </select>
                                    </div>

                                    <!-- Mobile Filter Toggle -->
                                    <button onclick="toggleFilters()" 
                                        class="md:hidden flex items-center justify-between px-4 py-2 border rounded-lg bg-gray-50 hover:bg-gray-100">
                                        <span class="text-sm font-medium text-gray-700">Date Range Filters</span>
                                        ${state.filtersExpanded ? icons.chevronUp : icons.chevronDown}
                                    </button>

                                    <!-- Date Range Filters -->
                                    <div class="md:block ${state.filtersExpanded ? 'block' : 'hidden md:block'}">
                                        <div class="flex flex-wrap gap-2 items-center">
                                            <span class="text-sm font-medium text-gray-700">Date Range:</span>
                                            <input type="date" 
                                                id="startDateInput"
                                                value="${state.filterCriteria.startDate}"
                                                class="px-3 py-1 text-sm border rounded flex-1 sm:flex-initial">
                                            <span class="text-sm text-gray-500">to</span>
                                            <input type="date" 
                                                id="endDateInput"
                                                value="${state.filterCriteria.endDate}"
                                                class="px-3 py-1 text-sm border rounded flex-1 sm:flex-initial">
                                            <button onclick="applyDateRange()" 
                                                class="w-full sm:w-auto px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">
                                                Apply
                                            </button>
                                        </div>
                                        <div class="flex gap-2 mt-2">
                                            <button onclick="setDatePreset(30)" 
                                                class="flex-1 sm:flex-initial px-3 py-1 text-sm border rounded hover:bg-gray-50">30 days</button>
                                            <button onclick="setDatePreset(90)" 
                                                class="flex-1 sm:flex-initial px-3 py-1 text-sm border rounded hover:bg-gray-50">90 days</button>
                                            <button onclick="setDatePreset(365)" 
                                                class="flex-1 sm:flex-initial px-3 py-1 text-sm border rounded hover:bg-gray-50">1 year</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Draggable Tabs -->
                        <div class="border-t ${state.tabEditMode ? 'tab-edit-mode bg-blue-50' : ''}">
                            <div class="max-w-7xl mx-auto px-4">
                                ${state.tabEditMode ? `
                                    <div class="py-2 flex items-center justify-between">
                                        <span class="text-sm text-blue-700 font-medium">âœ¨ Drag tabs to reorder</span>
                                        <button onclick="exitTabEditMode()" 
                                            class="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">
                                            Done
                                        </button>
                                    </div>
                                ` : ''}
                                <div class="tab-scroll-container flex space-x-1 overflow-x-auto">
                                    ${state.tabOrder.map(tab => `
                                        <button 
                                            draggable="${state.tabEditMode}"
                                            onmousedown="startLongPress(event, '${tab.id}')"
                                            onmouseup="cancelLongPress()"
                                            onmouseleave="cancelLongPress()"
                                            ontouchstart="startLongPress(event, '${tab.id}')"
                                            ontouchend="cancelLongPress()"
                                            ontouchcancel="cancelLongPress()"
                                            ondragstart="handleTabDragStart(event, '${tab.id}')"
                                            ondragover="handleTabDragOver(event)"
                                            ondragleave="handleTabDragLeave(event)"
                                            ondrop="handleTabDrop(event, '${tab.id}')"
                                            ondragend="handleTabDragEnd(event)"
                                            onclick="if(!state.tabEditMode) changeView('${tab.id}')" 
                                            class="draggable-tab px-3 md:px-4 py-3 flex items-center space-x-1 md:space-x-2 border-b-2 transition whitespace-nowrap ${
                                                state.selectedView === tab.id ? 
                                                'border-blue-600 text-blue-600' : 
                                                'border-transparent text-gray-600 hover:text-gray-900'
                                            } ${state.tabEditMode ? 'cursor-move' : ''}">
                                            ${state.tabEditMode ? `<span class="text-gray-400">${icons.grip}</span>` : ''}
                                            <span class="text-sm md:text-base">${tab.label}</span>
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="max-w-7xl mx-auto px-4 py-6">
                        ${state.loading ? renderLoading() : 
                          state.error ? renderError() : 
                          renderView(processedData, analytics)}
                    </div>
                </div>

                ${state.showBucketManager ? renderBucketManager() : ''}
                ${state.showBulkSearch ? renderBulkSearchModal() : ''}
                ${state.showSettingsMenu ? renderSettingsMenu() : ''}
            `;
        }

        function renderLoading() {
            return `
                <div class="flex items-center justify-center h-64">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                        <p class="mt-4 text-gray-600">Loading data...</p>
                    </div>
                </div>
            `;
        }

        function renderError() {
            return `
                <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
                    <p class="text-red-800">Error loading data: ${state.error}</p>
                    <button onclick="fetchData()" 
                        class="mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                        Retry
                    </button>
                </div>
            `;
        }

        function renderView(processedData, analytics) {
            const viewContent = document.createElement('div');
            
            if (state.selectedView === 'overview') {
                viewContent.innerHTML = `
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Total Cases</p>
                                    <p class="text-2xl md:text-3xl font-bold text-gray-900 mt-2">${analytics.totalCases}</p>
                                </div>
                                <div class="text-blue-600">${icons.building}</div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Pending Cases</p>
                                    <p class="text-2xl md:text-3xl font-bold text-red-600 mt-2">${analytics.pendingCases}</p>
                                </div>
                                <div class="text-red-600">${icons.alert}</div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Corporate Landlords</p>
                                    <p class="text-2xl md:text-3xl font-bold text-gray-900 mt-2">${analytics.corporateLandlords}</p>
                                </div>
                                <div class="text-blue-600">${icons.building}</div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Pro Se Defendants</p>
                                    <p class="text-2xl md:text-3xl font-bold text-yellow-600 mt-2">${analytics.proSeDefendants}</p>
                                </div>
                                <div class="text-yellow-600">${icons.user}</div>
                            </div>
                        </div>
                    </div>

                    ${state.buckets.length > 0 ? `
                        <div class="bg-white rounded-lg shadow-sm p-4 md:p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Bucket Overview</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                ${state.buckets.map(bucket => {
                                    const stats = analytics.bucketStats[bucket.id];
                                    return `
                                        <div class="border-l-4 border-${bucket.color}-500 bg-${bucket.color}-50 p-4 rounded cursor-pointer hover:shadow-md transition"
                                            onclick="selectBucket('${bucket.id}')">
                                            <div class="flex justify-between items-start mb-2">
                                                <h4 class="font-semibold text-${bucket.color}-900">${bucket.name}</h4>
                                                <span class="text-xl md:text-2xl font-bold text-${bucket.color}-700">${stats?.count || 0}</span>
                                            </div>
                                            <div class="text-sm text-${bucket.color}-700">
                                                ${stats?.percentage || 0}% of total cases
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    ` : ''}
                `;

            } else if (state.selectedView === 'attorneys') {
                // Show fewer items on mobile
                const isMobile = window.innerWidth < 768;
                const itemCount = isMobile ? 8 : 15;
                const mobileData = analytics.attorneyData.slice(0, itemCount);
                
                viewContent.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                        <h3 class="text-base md:text-lg font-semibold mb-4">Top ${itemCount} Attorneys by Case Volume</h3>
                        <div class="chart-container">
                            <canvas id="attorneyChart"></canvas>
                        </div>
                    </div>
                `;
                setTimeout(() => {
                    createBarChart('attorneyChart',
                        mobileData.map(a => a.count),
                        mobileData.map(a => a.name),
                        'Number of Cases'
                    );
                }, 100);

            } else if (state.selectedView === 'landlords') {
                // Show fewer items on mobile
                const isMobile = window.innerWidth < 768;
                const itemCount = isMobile ? 8 : 15;
                const mobileData = analytics.plaintiffData.slice(0, itemCount);
                
                viewContent.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                        <h3 class="text-base md:text-lg font-semibold mb-4">Top ${itemCount} Plaintiffs (Landlords) by Filing Volume</h3>
                        <div class="chart-container">
                            <canvas id="landlordChart"></canvas>
                        </div>
                    </div>
                `;
                setTimeout(() => {
                    createBarChart('landlordChart',
                        mobileData.map(p => p.count),
                        mobileData.map(p => p.name),
                        'Number of Cases'
                    );
                }, 100);

            } else if (state.selectedView === 'timeline') {
                const filingDates = Object.keys(analytics.dailyFilings).sort();
                const filingCounts = filingDates.map(date => analytics.dailyFilings[date]);

                viewContent.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Filing Timeline</h3>
                        <div class="chart-container">
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>
                `;
                setTimeout(() => {
                    createLineChart('timelineChart', filingCounts, filingDates);
                }, 100);

            } else if (state.selectedView === 'cases') {
                viewContent.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                        <h3 class="text-lg font-semibold mb-4">Case Details (${processedData.length} cases)</h3>
                        
                        <!-- Desktop Table View -->
                        <div class="hidden md:block overflow-x-auto">
                            <table class="desktop-table w-full text-sm">
                                <thead class="bg-gray-50 border-b-2 border-gray-200">
                                    <tr>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Docket #</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Filed</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Plaintiff (Landlord)</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Defendant (Tenant)</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Attorney</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700">Status</th>
                                        ${state.buckets.length > 0 ? '<th class="px-4 py-3 text-left font-semibold text-gray-700">Buckets</th>' : ''}
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${processedData.map(record => {
                                        const matchingBuckets = state.buckets.filter(b => recordMatchesBucket(record, b));
                                        return `
                                            <tr class="hover:bg-gray-50 transition">
                                                <td class="px-4 py-3 font-mono text-blue-600">${record.Docket_Number}</td>
                                                <td class="px-4 py-3">${record.File_Date}</td>
                                                <td class="px-4 py-3">
                                                    <div class="max-w-xs truncate" title="${record.Plaintiff_Petitioner}">
                                                        ${record.Plaintiff_Petitioner}
                                                    </div>
                                                </td>
                                                <td class="px-4 py-3 font-semibold">${record.Defendant_Respondent}</td>
                                                <td class="px-4 py-3">
                                                    ${record.Attorney?.includes('PRS') || record.Attorney?.trim() === ',' ? 
                                                        '<span class="inline-block px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded">Pro Se</span>' : 
                                                        record.Attorney
                                                    }
                                                </td>
                                                <td class="px-4 py-3">
                                                    <span class="inline-block px-2 py-1 text-xs rounded ${
                                                        record.Status === 'PENDING' ? 
                                                            'bg-red-100 text-red-800' : 
                                                            'bg-gray-100 text-gray-800'
                                                    }">
                                                        ${record.Status}
                                                    </span>
                                                </td>
                                                ${state.buckets.length > 0 ? `
                                                    <td class="px-4 py-3">
                                                        <div class="flex flex-wrap gap-1">
                                                            ${matchingBuckets.map(b => `
                                                                <span class="inline-block px-2 py-0.5 text-xs bg-${b.color}-100 text-${b.color}-800 rounded">
                                                                    ${b.name}
                                                                </span>
                                                            `).join('')}
                                                        </div>
                                                    </td>
                                                ` : ''}
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        <!-- Mobile Card View -->
                        <div class="mobile-cards md:hidden space-y-3">
                            ${processedData.map(record => {
                                const matchingBuckets = state.buckets.filter(b => recordMatchesBucket(record, b));
                                return `
                                    <div class="border rounded-lg p-4 hover:shadow-md transition">
                                        <div class="flex justify-between items-start mb-3">
                                            <div class="font-mono text-sm text-blue-600 font-semibold">${record.Docket_Number}</div>
                                            <span class="inline-block px-2 py-1 text-xs rounded ${
                                                record.Status === 'PENDING' ? 
                                                    'bg-red-100 text-red-800' : 
                                                    'bg-gray-100 text-gray-800'
                                            }">
                                                ${record.Status}
                                            </span>
                                        </div>
                                        
                                        <div class="space-y-2 text-sm">
                                            <div>
                                                <span class="text-gray-500 text-xs">Defendant:</span>
                                                <div class="font-semibold text-gray-900">${record.Defendant_Respondent}</div>
                                            </div>
                                            
                                            <div>
                                                <span class="text-gray-500 text-xs">Plaintiff:</span>
                                                <div class="text-gray-700">${record.Plaintiff_Petitioner}</div>
                                            </div>
                                            
                                            <div class="flex justify-between items-center pt-2 border-t">
                                                <div>
                                                    <span class="text-gray-500 text-xs">Filed:</span>
                                                    <div class="text-gray-700">${record.File_Date}</div>
                                                </div>
                                                <div>
                                                    ${record.Attorney?.includes('PRS') || record.Attorney?.trim() === ',' ? 
                                                        '<span class="inline-block px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded">Pro Se</span>' : 
                                                        `<span class="text-xs text-gray-600">${record.Attorney}</span>`
                                                    }
                                                </div>
                                            </div>
                                            
                                            ${matchingBuckets.length > 0 ? `
                                                <div class="pt-2 border-t">
                                                    <div class="flex flex-wrap gap-1">
                                                        ${matchingBuckets.map(b => `
                                                            <span class="inline-block px-2 py-0.5 text-xs bg-${b.color}-100 text-${b.color}-800 rounded">
                                                                ${b.name}
                                                            </span>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>

                        <div class="mt-6 border-t pt-4 text-sm text-gray-600 text-center">
                            Showing ${processedData.length} cases
                        </div>
                    </div>
                `;
            } else if (state.selectedView === 'buckets') {
                viewContent.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-semibold">Bucket Analytics</h3>
                                <button onclick="toggleBucketManager()" 
                                    class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center space-x-2">
                                    ${icons.edit}
                                    <span>Manage</span>
                                </button>
                            </div>

                            ${state.buckets.length === 0 ? `
                                <div class="text-center py-12">
                                    <p class="text-gray-600 mb-4">No buckets created yet</p>
                                    <button onclick="toggleBucketManager()" 
                                        class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                        Create Your First Bucket
                                    </button>
                                </div>
                            ` : `
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    ${state.buckets.map(bucket => {
                                        const stats = analytics.bucketStats[bucket.id];
                                        const bucketData = processedData.filter(r => recordMatchesBucket(r, bucket));
                                        const pendingCount = bucketData.filter(r => r.Status === 'PENDING').length;
                                        
                                        return `
                                            <div class="border-l-4 border-${bucket.color}-500 bg-${bucket.color}-50 p-6 rounded-lg">
                                                <div class="flex justify-between items-start mb-4">
                                                    <h4 class="text-xl font-bold text-${bucket.color}-900">${bucket.name}</h4>
                                                    <button onclick="selectBucket('${bucket.id}')" 
                                                        class="text-sm px-3 py-1 bg-${bucket.color}-600 text-white rounded hover:bg-${bucket.color}-700">
                                                        View Cases
                                                    </button>
                                                </div>
                                                
                                                <div class="space-y-3">
                                                    <div class="flex justify-between">
                                                        <span class="text-${bucket.color}-700">Total Cases:</span>
                                                        <span class="font-bold text-${bucket.color}-900">${stats?.count || 0}</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-${bucket.color}-700">Pending:</span>
                                                        <span class="font-bold text-${bucket.color}-900">${pendingCount}</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-${bucket.color}-700">% of Total:</span>
                                                        <span class="font-bold text-${bucket.color}-900">${stats?.percentage || 0}%</span>
                                                    </div>
                                                </div>

                                                <div class="mt-4 pt-4 border-t border-${bucket.color}-200">
                                                    <p class="text-xs text-${bucket.color}-700 font-medium mb-2">Rules (${bucket.matchType === 'any' ? 'ANY' : 'ALL'}):</p>
                                                    <div class="space-y-1">
                                                        ${bucket.rules.map(rule => `
                                                            <div class="text-xs text-${bucket.color}-600">
                                                                â€¢ ${rule.field} ${rule.operator} "${rule.value}"
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }

            return viewContent.innerHTML;
        }

        // Event handlers
        function updateSearch(value) {
            state.searchTerm = value;
            saveSettings();
            render();
        }

        function updateBucketFilter(bucketId) {
            state.selectedBucket = bucketId;
            state.selectedView = 'cases'; // Switch to cases view to show filtered results
            saveSettings();
            render();
        }

        function selectBucket(bucketId) {
            state.selectedBucket = bucketId;
            state.selectedView = 'cases';
            saveSettings();
            render();
        }

        function updateFilter(type, value) {
            state.filterCriteria[type] = value;
            saveSettings();
            fetchData();
        }

        function updateDateRange(startDate, endDate) {
            state.filterCriteria.startDate = startDate;
            state.filterCriteria.endDate = endDate;
            saveSettings();
            fetchData();
        }

        function applyDateRange() {
            const startInput = document.getElementById('startDateInput');
            const endInput = document.getElementById('endDateInput');
            
            if (startInput && endInput) {
                updateDateRange(startInput.value, endInput.value);
            }
        }

        function setDatePreset(days) {
            const endDate = getTodayDate();
            const startDate = getDateDaysAgo(days);
            updateDateRange(startDate, endDate);
        }

        function changeView(view) {
            state.selectedView = view;
            saveSettings();
            render();
        }

        function processBulkSearch() {
            const textarea = document.getElementById('bulkSearchInput');
            if (!textarea) return;
            
            const names = textarea.value
                .split('\n')
                .map(name => name.trim())
                .filter(name => name.length > 0);
            
            state.bulkSearchNames = names;
            state.showBulkSearch = false;
            state.selectedView = 'cases'; // Switch to cases view
            saveSettings();
            render();
        }

        function clearBulkSearch() {
            state.bulkSearchNames = [];
            saveSettings();
            render();
        }

        function updateFuzzyThreshold(value) {
            state.fuzzyThreshold = parseFloat(value);
            saveSettings();
            render();
        }

        function toggleMobileMenu() {
            state.showMobileMenu = !state.showMobileMenu;
            render();
        }

        function toggleFilters() {
            state.filtersExpanded = !state.filtersExpanded;
            render();
        }

        function toggleCaseCard(index) {
            const card = document.getElementById(`case-card-${index}`);
            if (card) {
                card.classList.toggle('expanded');
            }
        }

        function toggleMobileMenu() {
            state.showMobileMenu = !state.showMobileMenu;
            render();
        }

        function toggleFilters() {
            state.filtersExpanded = !state.filtersExpanded;
            render();
        }

        // Settings management
        function showSettingsMenu() {
            state.showSettingsMenu = !state.showSettingsMenu;
            render();
        }

        function exportSettings() {
            const settingsData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                settings: {
                    selectedView: state.selectedView,
                    selectedBucket: state.selectedBucket,
                    searchTerm: state.searchTerm,
                    bulkSearchNames: state.bulkSearchNames,
                    fuzzyThreshold: state.fuzzyThreshold,
                    filterCriteria: state.filterCriteria
                },
                tabOrder: state.tabOrder,
                buckets: state.buckets
            };

            const blob = new Blob([JSON.stringify(settingsData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `eviction-dashboard-settings-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        
                        // Import settings
                        if (imported.settings) {
                            state.selectedView = imported.settings.selectedView || 'overview';
                            state.selectedBucket = imported.settings.selectedBucket || 'all';
                            state.searchTerm = imported.settings.searchTerm || '';
                            state.bulkSearchNames = imported.settings.bulkSearchNames || [];
                            state.fuzzyThreshold = imported.settings.fuzzyThreshold !== undefined ? imported.settings.fuzzyThreshold : 0.7;
                            state.filterCriteria = imported.settings.filterCriteria || getDefaultSettings().filterCriteria;
                            saveSettings();
                        }
                        
                        // Import tab order
                        if (imported.tabOrder) {
                            saveTabOrder(imported.tabOrder);
                        }
                        
                        // Import buckets
                        if (imported.buckets) {
                            saveBuckets(imported.buckets);
                        }

                        alert('Settings imported successfully!');
                        fetchData();
                    } catch (error) {
                        console.error('Error importing settings:', error);
                        alert('Error importing settings. Please check the file format.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetAllSettings() {
            if (confirm('Are you sure you want to reset ALL settings to defaults? This will clear:\n\nâ€¢ Tab order\nâ€¢ Custom buckets\nâ€¢ Search filters\nâ€¢ Bulk searches\nâ€¢ Date ranges\n\nThis cannot be undone.')) {
                localStorage.removeItem('eviction_settings');
                localStorage.removeItem('eviction_tab_order');
                localStorage.removeItem('eviction_buckets');
                
                // Reset state
                const defaults = getDefaultSettings();
                state.selectedView = defaults.selectedView;
                state.selectedBucket = defaults.selectedBucket;
                state.searchTerm = defaults.searchTerm;
                state.bulkSearchNames = defaults.bulkSearchNames;
                state.filterCriteria = defaults.filterCriteria;
                state.tabOrder = defaultTabs;
                state.buckets = loadBuckets();
                state.showSettingsMenu = false;
                
                fetchData();
            }
        }

        function clearSearchHistory() {
            if (confirm('Clear search term and bulk searches?')) {
                state.searchTerm = '';
                state.bulkSearchNames = [];
                saveSettings();
                render();
            }
        }

        function getStorageSize() {
            let total = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key) && key.startsWith('eviction_')) {
                    total += localStorage[key].length + key.length;
                }
            }
            return (total / 1024).toFixed(2); // KB
        }

        function renderSettingsMenu() {
            const storageSize = getStorageSize();
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-end md:items-center justify-center z-50 p-0 md:p-4" onclick="if(event.target === this) showSettingsMenu()">
                    <div class="bg-white rounded-t-2xl md:rounded-lg shadow-xl w-full md:max-w-md mobile-drawer max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b px-4 md:px-6 py-4 flex justify-between items-center z-10">
                            <h2 class="text-lg md:text-xl font-bold">Settings & Data</h2>
                            <button onclick="showSettingsMenu()" class="text-gray-500 hover:text-gray-700 p-2">
                                ${icons.x}
                            </button>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <h3 class="font-semibold text-blue-900 mb-2">ðŸ’¾ Local Storage</h3>
                                <p class="text-sm text-blue-800 mb-2">All your settings are saved in your browser:</p>
                                <ul class="text-xs text-blue-700 space-y-1 mb-3">
                                    <li>âœ“ Tab order and layout</li>
                                    <li>âœ“ Custom buckets and rules</li>
                                    <li>âœ“ Search filters and date ranges</li>
                                    <li>âœ“ Bulk search lists</li>
                                    <li>âœ“ Fuzzy matching threshold</li>
                                    <li>âœ“ Selected view and bucket</li>
                                </ul>
                                <p class="text-xs text-blue-600">Using ${storageSize} KB of storage</p>
                            </div>

                            <div class="space-y-2">
                                <button onclick="exportSettings()" 
                                    class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center space-x-2">
                                    ${icons.download}
                                    <span>Export Settings</span>
                                </button>

                                <button onclick="importSettings()" 
                                    class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center space-x-2">
                                    ${icons.upload}
                                    <span>Import Settings</span>
                                </button>

                                <button onclick="clearSearchHistory()" 
                                    class="w-full px-4 py-3 border border-orange-300 text-orange-700 rounded-lg hover:bg-orange-50 flex items-center justify-center space-x-2">
                                    ${icons.x}
                                    <span>Clear Searches</span>
                                </button>

                                <button onclick="resetAllSettings()" 
                                    class="w-full px-4 py-3 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 flex items-center justify-center space-x-2">
                                    ${icons.alert}
                                    <span>Reset All Settings</span>
                                </button>
                            </div>

                            <div class="pt-4 border-t">
                                <p class="text-xs text-gray-500 text-center">
                                    Settings are stored locally in your browser.<br>
                                    They will persist across sessions but may be cleared if you clear browser data.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize
        fetchData();
    </script>
</body>
</html>
